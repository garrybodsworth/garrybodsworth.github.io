---
layout: post
title: "Development - STLPort versus Microsoft STL performance"
date: 2007-01-18T18:59:00+00:00
categories:
 - Visual Studio 2005
 - STL
alias: /2007/01/development-stlport-versus-microsoft.html
---

<div class='post'>
The product I work on uses STL in quite an aggressive way and also it permeates all of the source code, so any change to the performance of it can have very severe knock-on effects.<br /><br />We upgraded to Visual Studio .NET 2005 from Visual Studio .NET 2003 with <a href="http://stlport.sourceforge.net/">STLPort</a> 4.6.  We decided to make the switch to Microsoft STL which in coding terms was very simple.  This slowed the entire system down massively, especially in debug mode.  I covered in <a href="http://garrys-brain.blogspot.com/2006/10/visual-studio-2005-lets-break.html">a previous post</a> how to gain back some of the performance.  This speeds up the STL by a massive amount as the safe iterator and iterator checking have large overheads.<br /><br />In comparison to STLport the performance in debug is so much slower that it is completely unusable for anything beyond the most simple operations.<br /><br />In release mode the performance is not quite as bad.  For one of our large tests it takes approximately 30000 seconds with our old build system.  With the Microsoft STL with all the possible performance improvements possible the tests took over 36000 seconds to run.  The performance degradation was unacceptable.  It was not only the time but memory as well, with the large data sets we use this causes massive amounts of paging to hard drive.  The Microsoft STL uses about 50% more memory than STLport.<br /><br />Unfortunately STLport is not as easy to debug as the Microsoft implementation is coupled with the debugger.  But the performance degradation is simply too much to ignore.<br /><br />The current version of <a href="http://stlport.sourceforge.net/">STLport is 5.1</a> and works with loads of compilers and platforms.</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Leviana</div>
<div class='content'>
Do you know a software to find places to <a href="http://www.buy-withnoprescription.com/" rel="nofollow">Buy With No Prescription</a> ?</div>
</div>
<div class='comment'>
<div class='author'>teddy-the-pilot</div>
<div class='content'>
I used SGI STL (the one on which STLPort is based) with VC6, and it was 3 times as fast as  MS STL on average (with up to 7 times in some cases) in release mode. But SGI STL does not compile with newer MS compilers, so I had to switch back to MS STL. Fortunately, I have found STLPort, and now I am back to fast computing!</div>
</div>
<div class='comment'>
<div class='author'>luzr</div>
<div class='content'>
There really seems to be something wrong with STL in Visual Studio C++ 2005.<br /><br />When we were comparing U++ Core to GCC , MSC 7.1 and MSC 8.0 implementations, MSC 8.0 showed some really weird results, see here:<br /><br />http://www.ultimatepp.org/www$uppweb2$vsstd$en-us.html<br /><br />BTW, -GS- option does quite huge difference for our code.</div>
</div>
<div class='comment'>
<div class='author'>Jalf</div>
<div class='content'>
Hmm, interesting... And surprising.<br />About the memory side, Microsoft's implementation of stringstreams have a memory leak. I don't know if that could account for any of the increased memory consumption you noticed. (as far as I know, istringstream and ostringstream are safe to use. It's just the general one (std::stringstream) that leaks memory. Can't remember the exact details, but it doesn't handle multiple inheritance properly (since it inherits from both i- and ostringstream)<br /><br />About debugging, I read somewhere that it's possible to get the same support for custom types just by fiddling a bit with some of the configuration files. Of course, now I can't remember where I read it. But may be worth a bit of Googling. :)</div>
</div>
<div class='comment'>
<div class='author'>Garry Bodsworth</div>
<div class='content'>
I was a bit shocked by the results and using STLPort has not only sped up calculation time (we are talking several hours of calculation and a few gigs of memory used) but also helped make the UI more responsive.<br /><br />I thought the comparison between STLPort and MS-STL would have been much closer.</div>
</div>
<div class='comment'>
<div class='author'>vortic</div>
<div class='content'>
Interesting post Garry. I would have NEVER thought this to be the case. It is good to know.<br />Cheers.</div>
</div>
</div>
