
<!DOCTYPE HTML>
<html lang="en-gb">
<head>
  <meta charset="UTF-8">
  <title>Fragmented Memory</title>

  <meta name="author" content="Garry Bodsworth">
  
  <meta name="description" content="Writing a Decent Library Oct 29th, 2007 When you are writing a shared library (DLL) you have to put a lot of thought into the public interface which &hellip;">
  
  

  <link rel="canonical" href="http://www.fragmentedmemory.com/blog/2007/10/29/writing-decent-library">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/feed/" rel="alternate" title="Fragmented Memory" type="application/atom+xml">
</head>
  
<body class="default">
  <div id="wrapper">
    <div id="header">
  <h1><a href="/">Fragmented Memory</a></h1>
  
    <p>Garry Bodsworth's Blog (formerly Garry's Bit Patterns &amp; Programmer's Log)</p>
  
</div>
<ul id="social-links">
  
    <li><a class="rss" href="/feed/" title="RSS">RSS</a></li>
  
  
  
  
    <li><a class="twitter" href="http://twitter.com/garrybodsworth" title="Twitter">Twitter</a></li>
  
  
    <li><a class="github" href="https://github.com/garrybodsworth" title="GitHub">GitHub</a></li>
  
  
  
  
  
  
    <li><a class="pinboard" href="https://pinboard.in/u:garrybodsworth" title="Pinboard">Pinboard</a></li>
  
</ul>
<div class="clear"></div>
<ul id="nav">
  
    <li> <a href="/">blog</a> </li>
  

  
    <li><a href="/blog/archives">archives</a></li>
  

  
    <li><a href="/about">about</a></li>
  
</ul>

    <div id="main"> <div class="post-header">
  
    <h1 class="post-title">Writing a Decent Library</h1>
  
  








  


<time datetime="2007-10-29T20:58:00+00:00" pubdate data-updated="true">Oct 29<span>th</span>, 2007</time>
</div>

<div class="post-content"><div class='post'>
When you are writing a shared library (DLL) you have to put a lot of thought into the public interface which your customer (another programmer) will be using.<br /><br />What you have to work out is whether it is closed or open source, whether the binaries are supplied, and how you keep the user from having broken interfaces on different versions.  All of this is from the point of view from a C++ programmer.<br /><br />I think it is best to start with how not to write a closed-source library:<br />* Do not use templates.<br />* Do not have implementation half in the binary and half in the headers.<br />* Do not expose the innards of your program.<br /><br />When creating a closed-source library you have to firewall the innards (which are probably commercially sensitive) from the interface.  This would mean some use of the <a href="http://c2.com/cgi/wiki?PimplIdiom">Pimpl Idiom</a>.<br /><br />You need to use solidly defined types like if you were binding to another language like Python.  This means that the implementation can live in the binary and the interface is defined in your headers.<br /><br />One of the problems it is easy to encounter is when STL is exposed in the library.  The problem occurs when people use different implementations of the standard library which means you either need to maintain versions for that particular setup.<br /><br />By making those two decisions you can massively simplify the maintenance and the headaches of people trying to implement it.  You have to think carefully about the simplest interface for the developers who have to work out how to integrate it.<br /><br />By not exposing the innards of the library you can also protect yourself from problems when the library loads/unloads because you can&#8217;t have conflicting CRTs/libraries.<br /><br />I suppose what I am suggesting is to have the most simple public interface and make sure that all implementation is hidden away.  Almost only using a C interface for a library means you don&#8217;t encounter the problems where you have to think about supplying a version for each version of the compiler your users have.</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>John Torjo</div>
<div class='content'>
There&#8217;s a very nice article I recently read:<BR/><BR/><A HREF="http://www.artima.com/cppsource/type_erasure.html" REL="nofollow">http://www.artima.com/cppsource/type_erasure.html</A><BR/><BR/>Best,<BR/>John</div>
</div>
</div>
</div>


<div class="post-single">
  <div class="post-meta">
    

<span class="categories">
  Categories:
  
    <a class='category' href='/blog/categories/development/'>Development</a>, <a class='category' href='/blog/categories/libraries/'>Libraries</a>
  
</span>


    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.fragmentedmemory.com/blog/2007/10/29/writing-decent-library/" data-via="garrybodsworth" data-counturl="http://www.fragmentedmemory.com/blog/2007/10/29/writing-decent-library/" >Tweet</a>
  
  
  
</div>

    
  </div>
  <div class="clear"></div>

  
</div>
 </div>
    <div id="footer">
  <div class="panels">
    <div class="license">
      <h2>License</h2>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.
    </div>

    <div class="posts">
      <h2>Recent Posts</h2>
      <ul>
        
          <li>
            <a href="/blog/2013/06/18/new-location-and-new-blog-engine-and-old-content-restored/">New Location &amp; New Blog Engine &amp; Old Content Restored</a>
          </li>
        
          <li>
            <a href="/blog/2013/06/13/joining-microsoft/">Joining Microsoft</a>
          </li>
        
          <li>
            <a href="/blog/2013/06/13/leaving-bromium/">Leaving Bromium</a>
          </li>
        
          <li>
            <a href="/blog/2013/03/05/philip-su-engineering-process-and/">Philip Su - Engineering Process And Philosophy At Facebook</a>
          </li>
        
          <li>
            <a href="/blog/2013/03/05/more-creator-owned-comics-genocide/">More Creator-Owned Comics - Genocide: Duostar</a>
          </li>
        
      </ul>
    </div>
  </div>

  <p class="powered">
    Powered by <a href="http://octopress.org">Octopress</a> and <a href="https://github.com/iwinux/compbits">Compbits</a>
  </p>
</div>

  </div> <!-- #wrapper end -->

  

  


  

  

  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


</body>
</html>
