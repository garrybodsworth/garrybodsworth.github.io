
<!DOCTYPE HTML>
<html lang="en-gb">
<head>
  <meta charset="UTF-8">
  <title>Fragmented Memory</title>

  <meta name="author" content="Garry Bodsworth">
  
  <meta name="description" content="Intel 945GM Linux Drivers &#8211; UXA and Memory Leaks Jun 13th, 2009 One of the things I have been plugging away with at work is getting Intel &hellip;">
  
  

  <link rel="canonical" href="http://www.fragmentedmemory.com/blog/2009/06/13/intel-945gm-linux-drivers-uxa-and-memory-leaks">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Fragmented Memory" type="application/atom+xml">
</head>
  
<body class="default">
  <div id="wrapper">
    <div id="header">
  <h1><a href="/">Fragmented Memory</a></h1>
  
    <p>Garry Bodsworth's Blog (formerly Garry's Bit Patterns &amp; Programmer's Log)</p>
  
</div>
<ul id="social-links">
  
    <li><a class="feed" href="/atom.xml" title="RSS">RSS</a></li>
  
  
    <li><a class="twitter" href="http://twitter.com/garrybodsworth" title="Twitter">Twitter</a></li>
  
  
    <li> <a class="github" href="https://github.com/garrybodsworth" title="GitHub">GitHub</a> </li>
  
</ul>
<div class="clear"></div>
<ul id="nav">
  
    <li> <a href="/">blog</a> </li>
  

  
    <li><a href="/blog/archives">archives</a></li>
  
</ul>

    <div id="main"> <div class="post-header">
  
    <h1 class="post-title">Intel 945GM Linux Drivers &#8211; UXA and Memory Leaks</h1>
  
  








  


<time datetime="2009-06-13T00:00:00+01:00" pubdate data-updated="true">Jun 13<span>th</span>, 2009</time>
</div>

<div class="post-content"><p>One of the things I have been plugging away with at work is getting Intel 945GM graphics drivers working at their best. I was using 2.6 and 2.7 with the new UXA acceleration because it works really well with composite and xvideo.</p>

<p>The problem was there was a memory leak that you could drive a bus through. Because the Linux driver stack is so complex (Mesa, X Driver, X-server, kernel gubbins, the Direct Rendering Manager library) it was proving extremely difficult to find where the memory was going because it was still being used even when the process was closed.</p>

<p>With the code I was writing I found I could get the memory of the computer fully utilised in less than one hundred iterations. Luckily that meant I could write a <a href="http://lists.freedesktop.org/archives/intel-gfx/2009-May/002559.html">small test case</a>. The bug hit particularly hard in Moblin which relied on the Intel drivers and Clutter. At least five bugs in Freedesktop Bugzilla seem to report it, plenty in Launchpad, and several in Moblin.</p>

<p>As it turned out Shuang He of Intel diagnosed the root of the problem in the Mesa driver where pixmaps weren&#8217;t being released properly and has submitted <a href="http://lists.freedesktop.org/archives/intel-gfx/2009-June/002791.html">some patches</a> for that. The mesa patches have been applied if you use <a href="https://launchpad.net/~xorg-edgers/+archive/ppa">xorg-edgers</a> on Ubuntu which makes life a lot easier considering I spent four hours building my own fixed Mesa&#8230;</p>

<p>Not only this but there was a memory leak in Clutter (which I submitted patches for) which are now in their git master repository.</p>

<p>Now with both of those things fixed compositing windows using Clutter works brilliantly and will work for an extended period of time rather than falling over after a short time. Also if these patches are used on Moblin v2, you should get a better experience.</p>
</div>


<div class="post-single">
  <div class="post-meta">
    

<span class="categories">
  Categories:
  
    <a class='category' href='/blog/categories/uncategorized/'>Uncategorized</a>
  
</span>


    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.fragmentedmemory.com/blog/2009/06/13/intel-945gm-linux-drivers-uxa-and-memory-leaks/" data-via="garrybodsworth" data-counturl="http://www.fragmentedmemory.com/blog/2009/06/13/intel-945gm-linux-drivers-uxa-and-memory-leaks/" >Tweet</a>
  
  
  
</div>

    
  </div>
  <div class="clear"></div>

  
</div>
 </div>
    <div id="footer">
  <div class="panels">
    <div class="license">
      <h2>License</h2>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.
    </div>

    <div class="posts">
      <h2>Recent Posts</h2>
      <ul>
        
          <li>
            <a href="/blog/2013/06/18/new-location-and-new-blog-engine-and-old-content-restored/">New Location &amp; New Blog Engine &amp; Old Content Restored</a>
          </li>
        
          <li>
            <a href="/blog/2013/06/13/joining-microsoft/">Joining Microsoft</a>
          </li>
        
          <li>
            <a href="/blog/2013/06/13/leaving-bromium/">Leaving Bromium</a>
          </li>
        
          <li>
            <a href="/blog/2013/03/05/philip-su-engineering-process-and/">Philip Su - Engineering Process And Philosophy At Facebook</a>
          </li>
        
          <li>
            <a href="/blog/2013/03/05/more-creator-owned-comics-genocide/">More Creator-Owned Comics - Genocide: Duostar</a>
          </li>
        
      </ul>
    </div>
  </div>

  <p class="powered">
    Powered by <a href="http://octopress.org">Octopress</a> and <a href="https://github.com/iwinux/compbits">Compbits</a>
  </p>
</div>

  </div> <!-- #wrapper end -->

  

  


  

  

  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


</body>
</html>
