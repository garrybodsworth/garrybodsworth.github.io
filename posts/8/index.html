
<!DOCTYPE HTML>
<html lang="en-gb">
<head>
  <meta charset="UTF-8">
  <title>Fragmented Memory</title>

  <meta name="author" content="Garry Bodsworth">
  
  <meta name="description" content="Intel 945GM Linux Drivers &#8211; UXA and Memory Leaks One of the things I have been plugging away with at work is getting Intel 945GM graphics &hellip;">
  
  

  <link rel="canonical" href="http://www.fragmentedmemory.com/posts/8">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/feed/" rel="alternate" title="Fragmented Memory" type="application/atom+xml">
</head>
  
<body class="default">
  <div id="wrapper">
    <div id="header">
  <h1><a href="/">Fragmented Memory</a></h1>
  
    <p>Garry Bodsworth's Blog (formerly Garry's Bit Patterns &amp; Programmer's Log)</p>
  
</div>
<ul id="social-links">
  
    <li><a class="rss" href="/feed/" title="RSS">RSS</a></li>
  
  
  
  
    <li><a class="twitter" href="http://twitter.com/garrybodsworth" title="Twitter">Twitter</a></li>
  
  
    <li><a class="github" href="https://github.com/garrybodsworth" title="GitHub">GitHub</a></li>
  
  
  
    <li><a class="linkedin" href="http://www.linkedin.com/in/garrybodsworth">LinkedIn</a></li>
  
  
  
  
    <li><a class="pinboard" href="https://pinboard.in/u:garrybodsworth" title="Pinboard">Pinboard</a></li>
  
</ul>
<div class="clear"></div>
<ul id="nav">
  
    <li> <a href="/" class="current">blog</a> </li>
  

  
    <li><a href="/blog/archives">archives</a></li>
  

  
    <li><a href="/about">about</a></li>
  
</ul>

    <div id="main"> 

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2009/06/13/intel-945gm-linux-drivers-uxa-and-memory-leaks/">Intel 945GM Linux Drivers &#8211; UXA and Memory Leaks</a>
    </h1>
  
  








  


<time datetime="2009-06-13T00:00:00+01:00" pubdate data-updated="true"></time>
</div>

<div class="post-content"><p>One of the things I have been plugging away with at work is getting Intel 945GM graphics drivers working at their best. I was using 2.6 and 2.7 with the new UXA acceleration because it works really well with composite and xvideo.</p>

<p>The problem was there was a memory leak that you could drive a bus through. Because the Linux driver stack is so complex (Mesa, X Driver, X-server, kernel gubbins, the Direct Rendering Manager library) it was proving extremely difficult to find where the memory was going because it was still being used even when the process was closed.</p>

<p>With the code I was writing I found I could get the memory of the computer fully utilised in less than one hundred iterations. Luckily that meant I could write a <a href="http://lists.freedesktop.org/archives/intel-gfx/2009-May/002559.html">small test case</a>. The bug hit particularly hard in Moblin which relied on the Intel drivers and Clutter. At least five bugs in Freedesktop Bugzilla seem to report it, plenty in Launchpad, and several in Moblin.</p>

<p>As it turned out Shuang He of Intel diagnosed the root of the problem in the Mesa driver where pixmaps weren&#8217;t being released properly and has submitted <a href="http://lists.freedesktop.org/archives/intel-gfx/2009-June/002791.html">some patches</a> for that. The mesa patches have been applied if you use <a href="https://launchpad.net/~xorg-edgers/+archive/ppa">xorg-edgers</a> on Ubuntu which makes life a lot easier considering I spent four hours building my own fixed Mesa&#8230;</p>

<p>Not only this but there was a memory leak in Clutter (which I submitted patches for) which are now in their git master repository.</p>

<p>Now with both of those things fixed compositing windows using Clutter works brilliantly and will work for an extended period of time rather than falling over after a short time. Also if these patches are used on Moblin v2, you should get a better experience.</p>
</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2009/06/13/intel-945gm-linux-drivers-the-good-bits/">Intel 945GM Linux Drivers &#8211; the Good Bits</a>
    </h1>
  
  








  


<time datetime="2009-06-13T00:00:00+01:00" pubdate data-updated="true"></time>
</div>

<div class="post-content"><p>Using the latest Linux drivers for Intel 945GM are really, really good. The best drivers available for Linux displays in my humble opinion, especially since the deficiencies are more hardware related rather than the software.</p>

<p>Using the UXA acceleration you can even composite x-video windows in OpenGL. The 3D performance is impressive for such an old device and as of the end of last week xvmc was working as well with GEM. It uses the latest tech available in Linux display drivers like Kernel Mode Setting and DRI2 (which is a new interface for speaking to the kernel).</p>

<p>The latest drivers are also not only well capable of good compositing, but they are also capable of it without tearing, even with x-video surfaces. The actual rendering itself doesn&#8217;t tear any more thanks to people like <a href="http://virtuousgeek.org/blog/index.php/jbarnes">Jesse Barnes</a> who have put great effort into that work.</p>

<p>Since computers like netbooks/nettops are coming with the 945GM chipset, good support for it is essential. This is even better when it is open-source because you can help out with hackery and diagnosis (actually editing the code is very scary, but I tried a bit attempting to backport some changes to 2.7 because master was not stable enough at the time). It was a bit frustrating trying to balance performance, features and stability when deciding which driver version to finally run with, but I can see the driver is almost there with some minor stability work.</p>

<p>So I must say the guys have done really good work and 2.8 looks like it will be a really good release performance/feature-wise. I think I have wedged the hardware a few times, but I suppose the 2.7.99 releases are alpha, and also it is probably down to me hammering the graphics card.</p>
</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2009/06/13/cluttered-mind/">Cluttered Mind</a>
    </h1>
  
  








  


<time datetime="2009-06-13T00:00:00+01:00" pubdate data-updated="true"></time>
</div>

<div class="post-content"><p>Finally, I have contributed something back to an open-source project.</p>

<p>The memory leak in <a href="http://www.clutter-project.org">Clutter</a> I mentioned in a previous post has been fixed. I submitted the <a href="http://bugzilla.openedhand.com/show_bug.cgi?id=1640">patches</a> last week, and they got pushed onto master in time for Clutter 1.0.</p>

<p>I&#8217;ve been playing around with Clutter a bit more now and it is well inside the GTK+ comfort zone. I am really pleased I can contribute something useful to a project of this size because I am so used to using libraries but not actually fixing them. It&#8217;s the glory of open-source.</p>

<p>I&#8217;ve been playing around a little with Clutter 1.0 and its master clock based animation and it looks really interesting. Just be careful that some parameters are floats instead of ints now and this caused me to segfault.</p>
</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2009/05/16/displaylink-open-source/">DisplayLink Open Source</a>
    </h1>
  
  








  


<time datetime="2009-05-16T00:00:00+01:00" pubdate data-updated="true"></time>
</div>

<div class="post-content"><p>Yesterday <a href="http://www.displaylink.com">Displaylink</a> released Linux source code for its USB display adapters. The project is LGPL and available on <a href="http://freedesktop.org">FreeDesktop</a>. The project itself is called libdlo and is available from <a href="http://freedesktop.org/wiki/Software/libdlo">this link</a> with the Git repository <a href="http://cgit.freedesktop.org/libdlo/">here</a>. You can see DisplayLink&#8217;s announcement <a href="http://www.displaylink.com/news/news150509.htm">here</a>.</p>

<p>At the moment it is a low-level library for speaking to the device and is not yet wrapped in a Xorg driver. The code itself supports ASIC devices and only the USB versions (if that means something to you then you have probably worked for DisplayLink at some point).</p>

<p>The code itself is impressively documented, and means people should be able to get something up and running pretty fast. I&#8217;m sure some interesting and exciting projects will come out of this.</p>

<p>Well done to DisplayLink on doing this &#8211; this is going to be a really good thing for getting content onto displays. USB is a really good solution &#8211; imagine daisy-chaining lots of displays controlled by a single computer.</p>
</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2009/04/13/xbmc-mythtv-bridge/">XBMC MythTV Bridge</a>
    </h1>
  
  








  


<time datetime="2009-04-13T00:00:00+01:00" pubdate data-updated="true"></time>
</div>

<div class="post-content"><p>It seems I spoke to soon, I stumbled across <a href="http://code.google.com/p/mythbox/">MythBox</a> just after posting about MythTV. It seems it will let me schedule through XBMC my MythTV recordings and let me watch live TV.</p>

<p>The <a href="http://code.google.com/p/mythbox/wiki/Screenshots">screenshots here</a> look really good. And it seems then I will be able to leave behind MythFrontend. I&#8217;m not too sure where the Subversion repository lives, but you get all the python files in the tar.gz, which makes it look pretty hackable.</p>
</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2009/04/13/nvidia-linux-acpi-borked/">nVidia + Linux + ACPI = Borked</a>
    </h1>
  
  








  


<time datetime="2009-04-13T00:00:00+01:00" pubdate data-updated="true"></time>
</div>

<div class="post-content"><p>It&#8217;s a simple equation and has cost me a day of trying to get ACPI suspend/hibernate working on Linux. It took me long enough to realise it was the nVidia driver causing the issue.</p>

<p>Whenever I tried suspend or hibernate I would get a black screen with a flashing cursor in the top left. After working out it was the nVidia driver I tried all the remedies I could find on the Internet by other people with the same bug. What I discovered was this problem has been around for going on at least three years and no solution is being worked on.</p>

<p>The obvious articles are <a href="http://www.amitsrivastava.net/2008-03-23-hibernate-suspend-resolved-ubuntu-gutsy-nvidia-dell-vostro/">here</a>, <a href="https://help.ubuntu.com/community/NvidiaLaptopBinaryDriverSuspend">here</a>, <a href="http://us.download.nvidia.com/XFree86/Linux-x86/1.0-9755/README/appendix-f.html">here</a>, <a href="http://en.opensuse.org/Talk:NVidia_Suspend_HOWTO">here</a>, and <a href="http://susewiki.org/index.php?title=Suspending_with_the_NVidia_drivers">here</a>.</p>

<p>All solutions provide slightly different but the same solution, you need to set NvAGP in your xorg.conf to either 0 or 1 and optionally use agp=off for your kernel. I tried various concoctions and none of them worked.</p>

<p>I think I worked out what the problem is though. If your motherboard chipset is not nVidia (I think they call them nForce) then NvAGP will never work because mine always drops back to agpgart. This must be why most of the success is seen on laptops where the IGP must be using nVidia chipsets. My motherboard has a VIA chipset (old and crusty I know) with a GeForce 8500GT hence my complete and utter lack of success.</p>

<p>Like I said this problem has been around for quite a while and the chipset problem could be why the only responses I have read from nVidia is that they are unable to reproduce it. So for me it will be a new sensible graphics card with hopefully fairly open drivers.</p>
</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2009/04/13/how-to-ruin-a-long-weekend/">How to Ruin a Long Weekend</a>
    </h1>
  
  








  


<time datetime="2009-04-13T00:00:00+01:00" pubdate data-updated="true"></time>
</div>

<div class="post-content"><p>One of the things I was looking forward to this long weekend was watching DVDs. So I come back home on Thursday plonk my Tales Of The Black Freighter into my Windows Media Center 2005 box and I get jerky video and crackly sound. So I then spend a day trying to diagnose the problem&#8230;. Starting with making sure my Windows install is up to date with patches, new nVidia drivers (which managed to successfully break everything so I tried multiple versions), and new versions of the codecs I use. The best part was in Media Player I got no sound and fine video, but on Media Center I got jerky video and crackly sound. All from the same codec.</p>

<p>So, I decided it was time try MythTV properly, so I nuked the drive with a Xubuntu install which crashed halfway through showing me the true nature of my problem when there was no turning back &#8211; the DVD drive was dying. So I decided to proceed with my Linux install because I was on my way and liked the philosophy behind MythTV&#8217;s design.</p>

<p>Now three days later I have a mostly working system, but I have had a number of casualties. First my DVD drive, then I blew up my monitor which I had to drive all the way to the office to collect, and now my graphics card is living on borrowed time (I will post about that in a bit). None of it is MythTV&#8217;s or Ubuntu&#8217;s fault, but I should of known when the weekend starts badly it can only get worse. I even got so desperate I considered installing Vista, but I am now really close to getting the whole system up and running.</p>

<p>As for MythTV itself &#8211; the features it provides were exactly what I wanted, DVD, TV, CD music, random downloaded videos. But it has proved to be such a pain, some of it Xubuntu&#8217;s fault, some of it is MythTV&#8217;s, and my greatest share of pain has come from nVidia.</p>

<p>The backend design of MythTV is a real good idea but it is painful to get up and running &#8211; even with the nicely supplied packages. Especially if you decide to change your IP address or XMLTV stops working briefly. The setup user interface is designed to be used from a big screen, but is extremely unintuitive and counter to any GUI guidelines you have ever seen. It took about three attempts to get the hook up between XMLTV and my DVB-T card correct and in the database.</p>

<p>The frontend is okay, but is at least five years behind anything you have seen for media centers (they have a new version they are working on but there is no planned release yet). You have to fiddle around so you can successfully eject DVDs, get your remote set up (involving text configuration files) which works okay but not intuitively (the stop button doesn&#8217;t do what I expect on a Windows MCE remote), watch DVDs (enable the correct repositories), and getting your Samba mounts working (why on earth aren&#8217;t Samba shares an optional directory rather than having to mess around with fstab?)</p>

<p>I did try X-Box Media Center as a front-end for the MythTV backend. It is much nicer to look at, provides some real good features (with a great iPlayer plug-in), worked with the MCE remote flawlessly and sensibly, and is only lacking the ability to schedule recordings. If that was possible I would use that as a frontend, because it seems much more stable than the MythTV UI. I did also try Boxee, the commercial version of XBMC, but although it looked quite nice I found it was not as good as XBMC it is derived from and its MythTV frontend refused to work as it is broken.</p>

<p>My thoughts this weekend have gone from MCE2005 to MythTV to XBMC to Boxee to XBMC to MythTV&#8230;. That also discounts the amount of time I sat down considering how I would write my own.</p>

<p>My main work now is to get hibernate and suspend working, but that requires a post all of its own. At least at that point I will be functionally equivalent to my Windows MCE2005 install that I nuked.</p>
</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2009/03/22/watchmen/">Watchmen</a>
    </h1>
  
  








  


<time datetime="2009-03-22T00:00:00+00:00" pubdate data-updated="true"></time>
</div>

<div class="post-content"><p>Since I am so behind the times I finally saw Watchmen the movie today&#8230;. I didn&#8217;t know what to expect because it is a masterpiece of comic storytelling, but there are plenty of reviews out there to tell you whether they liked it or not.</p>

<p>What got me was a small part in the film when Rorschach goes into the bathroom to exact punishment on Big Figure and you can only see what the swinging door lets you. It was a masterful piece of storytelling which lets your imagination conjure up all kinds of terrible deaths. If noone has used this technique of the swinging door in films before then I applaud Zack Snyder for a piece of genuine cinema brilliance.</p>
</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2009/03/22/python-programming-dojo-cambridge/">Python Programming Dojo &#8211; Cambridge</a>
    </h1>
  
  








  


<time datetime="2009-03-22T00:00:00+00:00" pubdate data-updated="true"></time>
</div>

<div class="post-content"><p>Yesterday I ran the Python Programming Dojo in Cambridge. It was my first time running such a public speaking event. We had four people in attendance which made it a bit easier on me after four or five last minute drop-outs.</p>

<p>Basically, it was to cover getting started in Python development from first concepts through to more advanced ones. I can hardly believe I talked more or less continually for six hours(!) I had prepared cue cards so I didn&#8217;t forget any subjects I wanted to cover and had smushed together a load of examples to go with each subject.</p>

<p>One of the most bizarre things was I didn&#8217;t get onto the fact Python had classes until lunchtime at 1pm&#8230;. It was hard to try and cover the basics because everything relied on something else, so I was dynamically juggling the order of the subjects.</p>

<p>The best bit was the interaction where people were coding whilst I was talking and the discussion points and questions came out of that.</p>

<p>I found it really hard to explain list comprehensions because I kind of instinctively knew them, but I had managed up until now to never need to explain them.</p>

<p>The benefits of doing this class were many for me. First, up I had programmed in Python for a while but I just did it and didn&#8217;t really think about why and how much I had used. Organising those thoughts was invaluable. Also, had to do speaking at the front of the room and I think I did okay apart from waving my hands too much and using the word &#8220;mad&#8221; too often in the description of Python features&#8230; The other benefit was I learnt some things as well.</p>

<p>The main Python feature I learnt was the <a href="http://en.wikipedia.org/wiki/Flyweight_pattern">flyweight</a> pattern feature of Python classes. Basically if you define a variable as part of the class you maximise reuse of that object. If you defined a variable using self, it will be added to the class dictionary. We checked this by writing code which is the best way to learn.</p>

<p>I don&#8217;t know if I will end up running one again or if it is a one-off, but I will try to update my examples and subjects to reflect what I discovered throughout the day (if I actually transfer them to digital format rather than hand-written cards I&#8217;ll post it on here).</p>

<p>Finally, I&#8217;d like to thank <a href="http://www.red-gate.com/">Red Gate Software</a> for supplying refreshments and somewhere to host it, <a href="http://blog.software-acumen.com/">Mark Dalgarno</a> for organising it, and Clive Tong of Red Gate for making sure we could get in (and not forgetting the attendees).</p>
</div>
 </div>

  
  <div class="post"> <div class="post-header">
  
    <h1 class="post-title">
      <a href="/blog/2009/03/05/20-days-of-coda-the-last-ten/">20 Days of CODA &#8211; the Last Ten</a>
    </h1>
  
  








  


<time datetime="2009-03-05T00:00:00+00:00" pubdate data-updated="true"></time>
</div>

<div class="post-content"><p>The developers here at <a href="http://www.camvine.com">Camvine</a> held on to the <a href="http://twitter.com/camvine">Camvine Twitter Feed</a> for the full month with twenty examples of cool uses of the CODA digital signage system.</p>

<h1>11 &#8211; <a href="http://bit.ly/HLEAv">Entertain and educate people whilst they wait using Wikipedia and CODA</a></h1>

<h1>12 &#8211; <a href="http://bit.ly/12xSKm">Monitor your Asterisk Phone System in real time with CODA</a></h1>

<h1>13 &#8211; <a href="http://bit.ly/qKxpc">See who&#8217;s in, who&#8217;s out, and who&#8217;s busy with Skype statuses on CODA</a></h1>

<h1>14 &#8211; <a href="http://bit.ly/MiEY9">Help everyone countdown to important events CODA</a></h1>

<h1>15 &#8211; <a href="http://bit.ly/AwzIV">Publish straight to your CODA screen from your desktop with Dropbox</a></h1>

<h1>16 &#8211; <a href="http://bit.ly/25AZS">Keep up with the last.fm music charts on CODA</a></h1>

<h1>17 &#8211; <a href="http://bit.ly/qvmDu">Controlling a screen is child&#8217;s play &#8211; using Nabaztag to control CODA</a></h1>

<h1>18 &#8211; <a href="http://bit.ly/sz9wN">Using content scheduling to let your screen&#8217;s purpose change over time</a></h1>

<h1>19 &#8211; <a href="http://bit.ly/XVz9P">Find out what&#8217;s on the TV and Radio tonight using BBC&#8217;s Backstage APIs</a></h1>

<h1>20 &#8211; <a href="http://bit.ly/1607gL">Use CODA to help everyone keep an eye on their energy usage</a></h1>

<p>Here is the video of teh RFID bunny controlling the CODA screens:</p>

<p>You can see the <a href="http://blog.programmerslog.com/?p=309">first ten here</a>.</p>
</div>
 </div>


<div id="pagination">
  
    <a class="prev" href="9">&laquo;Previous</a>
  
  
    <a class="next" href="7">Next&raquo;</a>
  
</div>
 </div>
    <div id="footer">
  <div class="panels">
    <div class="license">
      <h2>License</h2>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.
    </div>

    <div class="posts">
      <h2>Recent Posts</h2>
      <ul>
        
          <li>
            <a href="/blog/2014/07/13/slash-dev-slash-summer-talk-security-is-hard/">/dev/summer talk - Security Is Hard</a>
          </li>
        
          <li>
            <a href="/blog/2014/07/13/djugl-talk-the-trojan-unicorn/">DJUGL Talk - The Trojan Unicorn</a>
          </li>
        
          <li>
            <a href="/blog/2014/07/13/back-at-bromium/">Back at Bromium</a>
          </li>
        
          <li>
            <a href="/blog/2013/06/22/rss-feed-moved-to-http-slash-slash-www-dot-fragmentedmemory-dot-com-slash-feed-slash/">RSS Feed Moved To http://www.fragmentedmemory.com/feed/</a>
          </li>
        
          <li>
            <a href="/blog/2013/06/18/new-location-and-new-blog-engine-and-old-content-restored/">New Location &amp; New Blog Engine &amp; Old Content Restored</a>
          </li>
        
      </ul>
    </div>

    <div class="posts">
      <h2>Links</h2>
      <a href='https://alpha.app.net/gjb' class='adn-button' target='_blank' data-type='follow' data-width='277' data-height='27' data-user-id='@gjb' data-show-username='1' rel='me'>Follow me on App.net</a><script>(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='//d2zh9g63fcvyrq.cloudfront.net/adn.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'adn-button-js'));</script>
    </div>
  </div>

  <p class="powered">
    Powered by <a href="http://octopress.org">Octopress</a> and <a href="https://github.com/iwinux/compbits">Compbits</a>
  </p>
</div>

  </div> <!-- #wrapper end -->

  

  


  

  

  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


</body>
</html>
